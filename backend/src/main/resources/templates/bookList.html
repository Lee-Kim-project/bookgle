<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:inline="text">
    <meta charset="UTF-8">
    <title> [[${bookTitle}]] ê²€ìƒ‰ ê²°ê³¼ | ì±…ì¥</title>
    <link rel="stylesheet" href="/css/bookList.css">
</head>
<body>

<!-- ìƒë‹¨ ê²€ìƒ‰ì°½ -->
<div class="search-container">
    <form action="/search/books" method="GET" class="search-form">
        <select name="category" class="search-select">
            <option value="title">ë„ì„œëª…</option>
            <option value="author">ì €ìëª…</option>
            <option value="publisher">ì¶œíŒì‚¬</option>
        </select>
        <span class="divider"></span>
        <input type="text" name="title" placeholder="ë„ì„œ ê²€ìƒ‰" class="search-input">
        <button type="submit" class="search-button">ğŸ”</button>
    </form>
</div>

<!--ê²€ìƒ‰ê²°ê³¼ & ì§€ì—­ ì„ íƒ ë“œë¡­ë‹¤ìš´-->
<div class="navbar">
    <span class="count">ì „ì²´ <span th:text="${booksCount}"></span>ê±´</span>
    <div class="regionDropdown">
        <button class="dropdown-toggle">ì§€ì—­ ì„ íƒ â–¼</button>
        <div class="dropdown-menu" id="regionDropdown">
            <label><input type="checkbox" name="region" value="ì„œìš¸" checked>ì„œìš¸ ì „ì²´</label>
            <label><input type="checkbox" name="region" value="ê°•ë‚¨êµ¬">ê°•ë‚¨êµ¬</label>
            <label><input type="checkbox" name="region" value="ê°•ë™êµ¬">ê°•ë™êµ¬</label>
            <label><input type="checkbox" name="region" value="ê°•ë¶êµ¬">ê°•ë¶êµ¬</label>
            <label><input type="checkbox" name="region" value="ê°•ì„œêµ¬">ê°•ì„œêµ¬</label>
            <label><input type="checkbox" name="region" value="ê´€ì•…êµ¬">ê´€ì•…êµ¬</label>
            <label><input type="checkbox" name="region" value="ê´‘ì§„êµ¬">ê´‘ì§„êµ¬</label>
            <label><input type="checkbox" name="region" value="êµ¬ë¡œêµ¬">êµ¬ë¡œêµ¬</label>
            <label><input type="checkbox" name="region" value="ê¸ˆì²œêµ¬">ê¸ˆì²œêµ¬</label>
            <label><input type="checkbox" name="region" value="ë…¸ì›êµ¬">ë…¸ì›êµ¬</label>
            <label><input type="checkbox" name="region" value="ë„ë´‰êµ¬">ë„ë´‰êµ¬</label>
            <label><input type="checkbox" name="region" value="ë™ëŒ€ë¬¸êµ¬">ë™ëŒ€ë¬¸êµ¬</label>
            <label><input type="checkbox" name="region" value="ë™ì‘êµ¬">ë™ì‘êµ¬</label>
            <label><input type="checkbox" name="region" value="ë§ˆí¬êµ¬">ë§ˆí¬êµ¬</label>
            <label><input type="checkbox" name="region" value="ì„œëŒ€ë¬¸êµ¬">ì„œëŒ€ë¬¸êµ¬</label>
            <label><input type="checkbox" name="region" value="ì„œì´ˆêµ¬">ì„œì´ˆêµ¬</label>
            <label><input type="checkbox" name="region" value="ì„±ë™êµ¬">ì„±ë™êµ¬</label>
            <label><input type="checkbox" name="region" value="ì„±ë¶êµ¬">ì„±ë¶êµ¬</label>
            <label><input type="checkbox" name="region" value="ì†¡íŒŒêµ¬">ì†¡íŒŒêµ¬</label>
            <label><input type="checkbox" name="region" value="ì–‘ì²œêµ¬">ì–‘ì²œêµ¬</label>
            <label><input type="checkbox" name="region" value="ì˜ë“±í¬êµ¬">ì˜ë“±í¬êµ¬</label>
            <label><input type="checkbox" name="region" value="ìš©ì‚°êµ¬">ìš©ì‚°êµ¬</label>
            <label><input type="checkbox" name="region" value="ì€í‰êµ¬">ì€í‰êµ¬</label>
            <label><input type="checkbox" name="region" value="ì¢…ë¡œêµ¬">ì¢…ë¡œêµ¬</label>
            <label><input type="checkbox" name="region" value="ì¤‘êµ¬">ì¤‘êµ¬</label>
            <label><input type="checkbox" name="region" value="ì¤‘ë‘êµ¬">ì¤‘ë‘êµ¬</label>
        </div>
    </div>
</div>

<!--ì±… ì •ë³´-->
<div class="container">
    <div class="book-card" th:each="book : ${books}">
        <div class="thumbnail">
            <img th:src="${book.imageUrl}" alt="book thumbnail">
        </div>

        <div class="info">
            <h4 class="title" th:text="${book.title}"></h4>
            <p><strong>ì €ì</strong> : <span th:text="${book.authors}"></span></p>
            <p><strong>ì¶œíŒì‚¬</strong> : <span th:text="${book.publisher}"></span></p>
            <p><strong>ì¶œíŒì¼</strong> : <span th:text="${book.publicationYear}"></span></p>
        </div>

        <!--ì§€ë„ ë²„íŠ¼-->
        <button class="map-button" th:attr="isbn=${book.isbn}">ì§€ë„</button>

        <!--ì¢‹ì•„ìš” ë²„íŠ¼-->
        <div class="favorite">
            <button class="heart-button">â¤ï¸</button>
        </div>
    </div>
</div>

<!--ì§€ì—­ ì„ íƒ ë“œë¡­ë‹¤ìš´ í† ê¸€ ê´€ë ¨ ë™ì‘-->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const toggleBtn = document.querySelector(".dropdown-toggle");
    const dropdownMenu = document.getElementById("regionDropdown");

    // ë“œë¡­ë‹¤ìš´ ì—´ê¸°/ë‹«ê¸°
    toggleBtn.addEventListener("click", function (e) {
      e.stopPropagation(); // ë²„íŠ¼ í´ë¦­ ì‹œ ì´ë²¤íŠ¸ ì „íŒŒ ë§‰ê¸°
      dropdownMenu.style.display = (dropdownMenu.style.display === "none" || dropdownMenu.style.display === "")
        ? "block"
        : "none";
    });

    // âœ… ë“œë¡­ë‹¤ìš´ ë‚´ë¶€ í´ë¦­ ì‹œ ì´ë²¤íŠ¸ ì „íŒŒ ë§‰ê¸° (ë‹«íˆì§€ ì•Šë„ë¡)
    dropdownMenu.addEventListener("click", function (e) {
      e.stopPropagation();
    });

    // ë°”ê¹¥ í´ë¦­í•˜ë©´ ë‹«ê¸°
    document.addEventListener("click", function () {
      dropdownMenu.style.display = "none";
    });
  });
</script>


<!--ì§€ë„ ë²„íŠ¼ í´ë¦­ ì‹œ ì„ íƒëœ ì§€ì—­ë“¤ê³¼ ì„ íƒëœ ì±…ì˜ isbnê°’ì„ search/librariesë¡œ ì „ì†¡ -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll(".map-button").forEach(function (button) {
      button.addEventListener("click", function () {
        const isbn = button.getAttribute("isbn");

        // ì²´í¬ëœ ì§€ì—­ ìˆ˜ì§‘
        const checkedRegions = Array.from(document.querySelectorAll('input[name="region"]:checked'))
          .map(input => input.value);

        // ì¿¼ë¦¬ìŠ¤íŠ¸ë§ êµ¬ì„±
        const params = new URLSearchParams();
        params.append("isbn", isbn);
        checkedRegions.forEach(region => params.append("regions", region));

        window.location.href = `/search/libraries?${params.toString()}`;

        // í˜ì´ì§€ ì´ë™
        window.location.href = `/search/libraries?${queryString}`;
      });
    });
  });
</script>

</body>
</html>

